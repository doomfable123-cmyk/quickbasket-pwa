<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no" />
    <title>QuickBasket - Smart Recipe & Grocery Manager</title>
    
    <!-- PWA Meta Tags -->
    <meta name="application-name" content="QuickBasket" />
    <meta name="description" content="Smart recipe and grocery list manager for tablets with web scraping capabilities" />
    <meta name="theme-color" content="#2c5530" />
    <meta name="background-color" content="#f8f9fa" />
    <meta name="display" content="standalone" />
    <meta name="orientation" content="any" />
    <meta name="start_url" content="/" />
    <meta name="scope" content="/" />
    
    <!-- Apple Touch Icons for iOS -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-title" content="QuickBasket" />
    <link rel="apple-touch-icon" sizes="192x192" href="/static/icon-192.png" />
    <link rel="apple-touch-icon" sizes="512x512" href="/static/icon-512.png" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json" />
    
    <!-- Favicon -->
    <link rel="icon" type="image/svg+xml" href="/static/icon.svg" />
    <link rel="shortcut icon" href="/static/icon.svg" />
    
    <!-- Microsoft Tiles -->
    <meta name="msapplication-TileColor" content="#2c5530" />
    <meta name="msapplication-TileImage" content="/static/icon-192.png" />
    <meta name="msapplication-config" content="/static/browserconfig.xml" />
    
    <style>
        /* Import Google Fonts for professional typography */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Poppins:wght@400;500;600;700&display=swap');
        
        :root {
            --primary-color: #475569;
            --primary-hover: #334155;
            --primary-light: #f1f5f9;
            --success-color: #65a30d;
            --success-hover: #4d7c0f;
            --success-light: #f7fee7;
            --danger-color: #dc2626;
            --danger-hover: #b91c1c;
            --danger-light: #fef2f2;
            --warning-color: #d97706;
            --warning-hover: #b45309;
            --accent-color: #7c3aed;
            --accent-hover: #6d28d9;
            --neutral-50: #fafafa;
            --neutral-100: #f4f4f5;
            --neutral-200: #e4e4e7;
            --neutral-300: #d4d4d8;
            --neutral-400: #a1a1aa;
            --neutral-500: #71717a;
            --neutral-600: #52525b;
            --neutral-700: #3f3f46;
            --neutral-800: #27272a;
            --neutral-900: #18181b;
            --gradient-primary: linear-gradient(135deg, #64748b 0%, #475569 100%);
            --gradient-success: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            --gradient-header: linear-gradient(135deg, #1e293b 0%, #334155 100%);
            --gradient-card: linear-gradient(135deg, #ffffff 0%, #f8fafc 100%);
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
            --shadow-xl: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            --border-radius: 12px;
            --border-radius-sm: 8px;
            --border-radius-lg: 16px;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%);
            min-height: 100vh;
            color: var(--neutral-800);
            line-height: 1.6;
            font-size: 16px;
        }

        header {
            background: var(--gradient-header);
            backdrop-filter: blur(20px);
            box-shadow: var(--shadow-lg);
            padding: 1.5rem 2rem;
            position: sticky;
            top: 0;
            z-index: 100;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-container {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: white;
            background: rgba(255, 255, 255, 0.2);
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        .header-content h1 {
            font-family: 'Poppins', sans-serif;
            color: white;
            font-size: 1.5rem;
            font-weight: 600;
            letter-spacing: -0.025em;
        }

        .nav-button {
            display: inline-flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            text-decoration: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .nav-button:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        main {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 0 1rem;
        }
        .recipes-block {
            background: white;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            overflow: hidden;
            border: 1px solid var(--neutral-200);
            margin-bottom: 2rem;
        }

        .recipes-header {
            background: var(--gradient-success);
            padding: 2rem;
            border-bottom: 1px solid var(--neutral-200);
        }

        .recipes-header h2 {
            font-family: 'Poppins', sans-serif;
            font-size: 2rem;
            font-weight: 700;
            color: var(--neutral-700);
            letter-spacing: -0.025em;
            margin: 0;
        }

        .recipes-content {
            padding: 2rem;
        }

        .recipe-item {
            background: var(--gradient-card);
            border: 1px solid var(--neutral-200);
            border-radius: var(--border-radius);
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            overflow: hidden;
        }

        .recipe-item:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
            border-color: var(--neutral-300);
        }

        .recipe-item:last-child {
            margin-bottom: 0;
        }

        .recipe-checkbox {
            width: 1.25rem;
            height: 1.25rem;
            border: 2px solid var(--neutral-300);
            border-radius: 6px;
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            background: white;
            flex-shrink: 0;
        }

        .recipe-checkbox:checked {
            background: var(--success-color);
            border-color: var(--success-color);
        }

        .recipe-checkbox:checked::before {
            content: '‚úì';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .recipe-checkbox:hover {
            border-color: var(--success-color);
            box-shadow: 0 0 0 3px rgba(101, 163, 13, 0.1);
        }

        .recipe-info {
            flex-grow: 1;
            min-width: 0;
        }

        .recipe-title {
            font-family: 'Poppins', sans-serif;
            font-weight: 600;
            font-size: 1.1rem;
            color: var(--neutral-800);
            margin-bottom: 0.5rem;
            line-height: 1.4;
        }

        .recipe-date {
            font-size: 0.9rem;
            color: var(--neutral-500);
            font-weight: 400;
        }

        .recipe-meta {
            display: flex;
            align-items: center;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .toggle-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--border-radius-sm);
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .toggle-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .recipe-details {
            margin-top: 1rem;
            padding: 1rem;
            background: var(--neutral-50);
            border-radius: var(--border-radius-sm);
            border-left: 4px solid var(--primary-color);
            display: none;
        }

        .recipe-details h4 {
            font-family: 'Poppins', sans-serif;
            color: var(--neutral-700);
            margin-bottom: 0.5rem;
            font-size: 1rem;
        }

        .recipe-details ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .recipe-details li {
            padding: 0.25rem 0;
            color: var(--neutral-600);
            border-bottom: 1px solid var(--neutral-200);
        }

        .recipe-details li:last-child {
            border-bottom: none;
        }

        .delete-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: var(--danger-color);
            color: white;
            border: none;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            opacity: 0;
        }

        .recipe-item:hover .delete-btn {
            opacity: 1;
        }

        .delete-btn:hover {
            background: var(--danger-hover);
            transform: scale(1.1);
        }

        .action-buttons {
            margin-top: 2rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .search-container {
            margin: 2rem 0;
        }

        .search-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 1px solid var(--neutral-300);
            border-radius: var(--border-radius);
            font-size: 1rem;
            font-family: 'Inter', sans-serif;
            color: var(--neutral-800);
            background: white;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(71, 85, 105, 0.1);
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: var(--border-radius);
            font-weight: 500;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            text-decoration: none;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-sm);
            gap: 0.5rem;
        }

        .btn:before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            transition: left 0.5s;
        }

        .btn:hover:before {
            left: 100%;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-success {
            background: #166534;  /* Darker green */
            color: white;
        }

        .btn-success:hover {
            background: #14532d;  /* Even darker green on hover */
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-danger {
            background: #dc2626;  /* Same as grocery list danger-color */
            color: white;
        }

        .btn-danger:hover {
            background: #b91c1c;  /* Same as grocery list danger-hover */
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .add-recipe-btn {
            background: var(--primary-color);
            color: white;
        }

        .add-recipe-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Popup styles */
        .popup-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            animation: fadeIn 0.3s ease;
        }

        .popup-content {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 2rem;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-xl);
            z-index: 1001;
            width: min(400px, 90vw);
            border: 1px solid var(--neutral-200);
            animation: slideInUp 0.3s ease;
        }

        .popup-content h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--neutral-800);
            margin: 0 0 1.5rem 0;
        }

        .popup-btn {
            display: block;
            width: 100%;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .popup-btn:hover {
            background: var(--primary-hover);
            transform: translateY(-1px);
        }

        .popup-btn:last-of-type {
            margin-bottom: 0;
        }

        .close-popup {
            position: absolute;
            top: 1rem;
            right: 1rem;
            font-size: 1.5rem;
            color: var(--neutral-400);
            cursor: pointer;
            border: none;
            background: none;
            padding: 0.25rem;
            border-radius: 50%;
            width: 2rem;
            height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .close-popup:hover {
            color: var(--neutral-600);
            background: var(--neutral-100);
        }

        .empty-state {
            text-align: center;
            padding: 4rem 2rem;
            color: var(--neutral-500);
        }

        .empty-state h3 {
            font-family: 'Poppins', sans-serif;
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--neutral-600);
        }

        .empty-state p {
            font-size: 1.1rem;
            line-height: 1.6;
            margin-bottom: 2rem;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideInUp {
            from {
                opacity: 0;
                transform: translate(-50%, -40%);
            }
            to {
                opacity: 1;
                transform: translate(-50%, -50%);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .recipe-item {
            animation: fadeInUp 0.6s ease-out backwards;
        }

        .recipe-item:nth-child(n) {
            animation-delay: calc(0.1s * var(--i, 0));
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-container {
                flex-direction: column;
                gap: 1rem;
            }
            
            .action-buttons {
                flex-direction: column;
            }
            
            .popup-content {
                margin: 1rem;
                width: calc(100% - 2rem);
            }
        }

        /* Flash messages */
        .flash-messages {
            margin-bottom: 2rem;
        }

        .flash {
            padding: 1rem 1.5rem;
            margin-bottom: 1rem;
            border-radius: var(--border-radius);
            font-weight: 500;
            border: 1px solid;
        }

        .flash.success {
            background: var(--success-light);
            color: var(--success-hover);
            border-color: var(--success-color);
        }

        .flash.error {
            background: var(--danger-light);
            color: var(--danger-hover);
            border-color: var(--danger-color);
        }
    </style>
    
    <!-- PWA Meta Tags -->
    <meta name="theme-color" content="#2c5530" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="default" />
    <meta name="apple-mobile-web-app-title" content="QuickBasket" />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="application-name" content="QuickBasket" />
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="/static/manifest.json" />
    
    <!-- PWA Icons -->
    <link rel="apple-touch-icon" href="/static/icon-192.png.svg" />
    <link rel="icon" type="image/svg+xml" sizes="192x192" href="/static/icon-192.png.svg" />
    <link rel="icon" type="image/svg+xml" sizes="512x512" href="/static/icon-512.png.svg" />
</head>
<body>
    <header>
        <div class="header-container">
            <div class="header-left">
                <div class="logo">QB</div>
                <div class="header-content">
                    <h1>üçΩÔ∏è Welcome to QuickBasket</h1>
                </div>
            </div>
            <a href="/grocery_list/" class="nav-button">üõí Grocery List</a>
        </div>
    </header>
    <main>
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                <div class="flash-messages">
                    {% for category, message in messages %}
                        <div class="flash {{ category }}">{{ message }}</div>
                    {% endfor %}
                </div>
            {% endif %}
        {% endwith %}
        
        {% if recipes %}
            <div class="recipes-block">
                <div class="recipes-header">
                    <h2>üçΩÔ∏è Your Recipe Collection</h2>
                </div>
                <div class="recipes-content">
                    <form id="groceryListForm" onsubmit="addToGroceryList(event)">
                        <div class="action-buttons">
                            <button type="submit" class="btn btn-success">‚úì Add Selected to Grocery List</button>
                            <button type="button" class="btn btn-danger" onclick="deleteSelectedRecipes()">üóëÔ∏è Delete Selected</button>
                            <a href="#" class="btn add-recipe-btn">‚ûï Add Recipe</a>
                        </div>
                        
                        <div class="search-container">
                            <input type="text" id="recipe-search" class="search-input" placeholder="üîç Search recipes by name or ingredients...">
                        </div>
                        
                        <div id="status-message" style="margin: 1rem 0; padding: 1rem; border-radius: var(--border-radius); display: none;"></div>
                        
                        <div id="recipe-list">
                            {% for recipe in recipes %}
                                <div class="recipe-item" style="--i: {{ loop.index0 }}">
                                    <input type="checkbox" name="recipe_ids" value="{{ recipe.id }}" class="recipe-checkbox" id="recipe-{{ recipe.id }}">
                                    <div class="recipe-info">
                                        <div class="recipe-title">
                                            <label for="recipe-{{ recipe.id }}">{{ recipe.title }}</label>
                                        </div>
                                        <div class="recipe-meta">
                                            {% if recipe.last_added_to_grocery %}
                                                <div class="recipe-date">
                                                    {% set date_parts = recipe.last_added_to_grocery.split('T')[0].split('-') %}
                                                    Last added: {{ date_parts[1] }}-{{ date_parts[2] }}-{{ date_parts[0] }}
                                                </div>
                                            {% endif %}
                                            <button type="button" class="toggle-btn" onclick="toggleDetails('details-{{ recipe.id }}', this)">
                                                Show Details ‚ñº
                                            </button>
                                        </div>
                                        <div id="details-{{ recipe.id }}" class="recipe-details" style="display: none;">
                                            <h4>ü•ò Ingredients:</h4>
                                            <ul>
                                                {% for ingredient in recipe.ingredients %}
                                                    {% if ingredient.strip() %}
                                                        <li>{{ ingredient.strip() }}</li>
                                                    {% endif %}
                                                {% endfor %}
                                            </ul>
                                        </div>
                                    </div>
                                    <button type="button" class="delete-btn" onclick="deleteRecipe({{ recipe.id }})" title="Delete Recipe">‚úï</button>
                                </div>
                            {% endfor %}
                        </div>
                    </form>
                </div>
            </div>
        {% else %}
            <div class="recipes-block">
                <div class="recipes-content">
                    <div class="empty-state">
                        <h3>No recipes yet!</h3>
                        <p>Start building your recipe collection by adding your first recipe.</p>
                        <a href="#" class="btn add-recipe-btn">‚ûï Add Your First Recipe</a>
                    </div>
                </div>
            </div>
        {% endif %}
    </main>

    <!-- Add Recipe Popup -->
    <div id="addRecipePopup" class="popup-overlay">
        <div class="popup-content">
            <button class="close-popup" onclick="closePopup()">&times;</button>
            <h3>‚ú® Add Recipe</h3>
            <button class="popup-btn" onclick="window.location.href='/add-recipe-url'">üåê Add from URL</button>
            <button class="popup-btn" onclick="window.location.href='/add-recipe-manual'">‚úèÔ∏è Manual Entry</button>
        </div>
    </div>

    <script>
        // Initialize everything when the DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            const addRecipeBtn = document.querySelector('a.add-recipe-btn');
            const popup = document.getElementById('addRecipePopup');
            const searchInput = document.getElementById('recipe-search');

            // Initialize recipe details
            document.querySelectorAll('.recipe-details').forEach(details => {
                details.style.display = 'none';
            });

            // Handle search functionality
            if (searchInput) {
                searchInput.addEventListener('input', function(e) {
                    const searchText = e.target.value.toLowerCase();
                    document.querySelectorAll('.recipe-item').forEach(item => {
                        const title = item.querySelector('.recipe-title label').textContent.toLowerCase();
                        const ingredients = Array.from(item.querySelectorAll('.recipe-details li'))
                            .map(li => li.textContent.toLowerCase())
                            .join(' ');
                        item.style.display = (title.includes(searchText) || ingredients.includes(searchText))
                            ? ''
                            : 'none';
                    });
                });
            }

            // Handle Add Recipe popup
            if (addRecipeBtn) {
                addRecipeBtn.addEventListener('click', function(e) {
                    e.preventDefault();
                    popup.style.display = 'block';
                });
            }

            // Close popup when clicking outside
            popup.addEventListener('click', function(e) {
                if (e.target === popup) {
                    closePopup();
                }
            });

            // Close popup when pressing Escape key
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape' && popup.style.display === 'block') {
                    closePopup();
                }
            });
        });

        // Handle toggle details
        function toggleDetails(detailsId, button) {
            const details = document.getElementById(detailsId);
            if (!details) return;
            
            const isHidden = details.style.display === 'none';
            details.style.display = isHidden ? 'block' : 'none';
            button.textContent = isHidden ? 'Hide Details ‚ñ≤' : 'Show Details ‚ñº';
        }

        // Handle delete selected recipes
        function deleteSelectedRecipes() {
            const selectedRecipes = document.querySelectorAll('.recipe-checkbox:checked');
            
            if (selectedRecipes.length === 0) {
                alert('Please select at least one recipe to delete.');
                return;
            }

            if (confirm(`Are you sure you want to delete ${selectedRecipes.length} selected recipe(s)?`)) {
                const recipeIds = Array.from(selectedRecipes).map(checkbox => checkbox.value);
                
                // Create a form to submit the delete request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/delete-recipes';
                
                // Add recipe IDs as hidden inputs
                recipeIds.forEach(id => {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'recipe_ids';
                    input.value = id;
                    form.appendChild(input);
                });
                
                // Submit the form
                document.body.appendChild(form);
                form.submit();
            }
        }

        // Close popup function
        function closePopup() {
            document.getElementById('addRecipePopup').style.display = 'none';
        }

        // Handle adding recipes to grocery list
        function addToGroceryList(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            const statusMessage = document.getElementById('status-message');

            // Get current date in MM-DD-YYYY format
            const now = new Date();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const year = now.getFullYear();
            const dateStr = `${month}-${day}-${year}`;

            fetch("{{ url_for('add_to_grocery_list') }}", {
                method: "POST",
                body: formData
            })
            .then(response => response.json())
            .then(data => {
                statusMessage.style.display = 'block';
                if (data.status === 'success') {
                    // Update the last added date for each selected recipe
                    const selectedRecipes = document.querySelectorAll('.recipe-checkbox:checked');
                    selectedRecipes.forEach(checkbox => {
                        const recipeItem = checkbox.closest('.recipe-item');
                        let dateDiv = recipeItem.querySelector('.recipe-date');
                        if (!dateDiv) {
                            dateDiv = document.createElement('div');
                            dateDiv.className = 'recipe-date';
                            recipeItem.querySelector('.recipe-meta').insertBefore(dateDiv, recipeItem.querySelector('.toggle-btn'));
                        }
                        dateDiv.textContent = `Last added: ${dateStr}`;
                    });

                    statusMessage.style.backgroundColor = '#d4edda';
                    statusMessage.style.color = '#155724';
                    statusMessage.textContent = data.message;
                    
                    // Add link to grocery list
                    const link = document.createElement('a');
                    link.href = data.groceryListUrl;
                    link.textContent = ' View Grocery List';
                    link.style.marginLeft = '10px';
                    statusMessage.appendChild(link);
                } else {
                    statusMessage.style.backgroundColor = '#f8d7da';
                    statusMessage.style.color = '#721c24';
                    statusMessage.textContent = data.message;
                }

                // Hide the message after 5 seconds
                setTimeout(() => {
                    statusMessage.style.display = 'none';
                }, 5000);
            })
            .catch(error => {
                console.error('Error:', error);
                statusMessage.style.display = 'block';
                statusMessage.style.backgroundColor = '#f8d7da';
                statusMessage.style.color = '#721c24';
                statusMessage.textContent = 'Error adding recipes to grocery list.';
            });
        }

        // Handle individual recipe deletion
        function deleteRecipe(recipeId) {
            if (confirm('Are you sure you want to delete this recipe?')) {
                // Create a form to submit the delete request
                const form = document.createElement('form');
                form.method = 'POST';
                form.action = '/delete-recipes';
                
                // Add recipe ID as hidden input
                const input = document.createElement('input');
                input.type = 'hidden';
                input.name = 'recipe_ids';
                input.value = recipeId;
                form.appendChild(input);
                
                // Submit the form
                document.body.appendChild(form);
                form.submit();
            }
        }
    </script>

    <!-- PWA Service Worker Registration -->
    <script>
        // Register service worker for PWA functionality
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', function() {
                navigator.serviceWorker.register('/static/sw.js')
                    .then(function(registration) {
                        console.log('QuickBasket PWA: Service Worker registered successfully:', registration.scope);
                    })
                    .catch(function(error) {
                        console.log('QuickBasket PWA: Service Worker registration failed:', error);
                    });
            });
        }

        // PWA install prompt - Enhanced for all devices with better Chrome support
        let deferredPrompt;
        let installPromptShown = false;
        let installabilityChecked = false;
        
        // Check if PWA can be installed
        function checkInstallability() {
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            const isAndroid = /Android/.test(navigator.userAgent);
            
            console.log('PWA Install Check:', {
                isIOS: isIOS,
                isChrome: isChrome,
                isAndroid: isAndroid,
                hasServiceWorker: 'serviceWorker' in navigator,
                isStandalone: window.matchMedia('(display-mode: standalone)').matches,
                deferredPrompt: !!deferredPrompt,
                userAgent: navigator.userAgent
            });
            
            // Check if already installed
            if (window.matchMedia('(display-mode: standalone)').matches) {
                console.log('PWA: Already installed, hiding install prompts');
                return false;
            }
            
            installabilityChecked = true;
            return true;
        }
        
        // Create install banner for all devices
        function createInstallBanner() {
            if (installPromptShown || !checkInstallability()) return;
            
            const banner = document.createElement('div');
            banner.id = 'install-banner';
            banner.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                background: linear-gradient(135deg, #2c5530 0%, #3d7c47 100%);
                color: white;
                padding: 16px;
                text-align: center;
                font-size: 14px;
                font-weight: 500;
                box-shadow: 0 4px 12px rgba(0,0,0,0.15);
                z-index: 10001;
                transform: translateY(-100%);
                transition: transform 0.3s ease-in-out;
                display: flex;
                align-items: center;
                justify-content: space-between;
                flex-wrap: wrap;
                gap: 12px;
            `;
            
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
            
            let message = '';
            let instructions = '';
            let buttonText = 'Install Now';
            
            if (isIOS) {
                message = 'üì± Install QuickBasket as an App on your iPad/iPhone';
                instructions = 'Tap the Share button ‚ÜóÔ∏è then "Add to Home Screen"';
                buttonText = 'Show Instructions';
            } else if (isAndroid && isChrome) {
                message = 'üì± Install QuickBasket as an App on your Android device';
                instructions = deferredPrompt ? 'Click Install Now or use browser menu ‚ãÆ' : 'Tap the menu (‚ãÆ) then "Add to Home screen"';
                buttonText = deferredPrompt ? 'Install Now' : 'Show Instructions';
                
                // Add diagnostic info for Android Chrome users
                if (!deferredPrompt) {
                    instructions += ' ‚Ä¢ <span style="color: #fbbf24;">No auto-install available</span>';
                }
            } else if (isAndroid) {
                message = 'üì± Install QuickBasket as an App on your Android device';
                instructions = 'Tap the menu (‚ãÆ) then "Add to Home screen" or "Install app"';
                buttonText = 'Show Instructions';
            } else {
                message = 'üì± Install QuickBasket as an App';
                instructions = 'Look for install options in your browser menu';
                buttonText = 'Show Instructions';
            }
            
            banner.innerHTML = `
                <div style="flex: 1; min-width: 300px;">
                    <div style="font-weight: 600; margin-bottom: 4px;">${message}</div>
                    <div style="font-size: 12px; opacity: 0.9;">${instructions}</div>
                </div>
                <div style="display: flex; gap: 8px; align-items: center; flex-wrap: wrap;">
                    <button id="install-now" style="
                        background: rgba(255,255,255,0.2);
                        border: 1px solid rgba(255,255,255,0.3);
                        color: white;
                        padding: 8px 16px;
                        border-radius: 20px;
                        font-size: 12px;
                        font-weight: 600;
                        cursor: pointer;
                        backdrop-filter: blur(10px);
                        transition: all 0.2s ease;
                    ">${buttonText}</button>
                    ${isAndroid && isChrome ? `
                        <button id="debug-install" style="
                            background: rgba(255,193,7,0.2);
                            border: 1px solid rgba(255,193,7,0.4);
                            color: white;
                            padding: 6px 12px;
                            border-radius: 15px;
                            font-size: 11px;
                            font-weight: 500;
                            cursor: pointer;
                            backdrop-filter: blur(10px);
                            transition: all 0.2s ease;
                        ">üîß Debug</button>
                    ` : ''}
                    <button id="install-close" style="
                        background: transparent;
                        border: none;
                        color: white;
                        font-size: 18px;
                        cursor: pointer;
                        padding: 4px 8px;
                        opacity: 0.8;
                    ">√ó</button>
                </div>
            `;
            
            document.body.appendChild(banner);
            
            // Animate in
            setTimeout(() => {
                banner.style.transform = 'translateY(0)';
            }, 500);
            
            // Event handlers
            document.getElementById('install-close').onclick = () => {
                banner.style.transform = 'translateY(-100%)';
                setTimeout(() => banner.remove(), 300);
                localStorage.setItem('pwa-install-dismissed', Date.now());
            };
            
            document.getElementById('install-now').onclick = async () => {
                console.log('Install button clicked', { deferredPrompt: !!deferredPrompt });
                
                if (deferredPrompt) {
                    // Chrome/Edge install with better error handling
                    try {
                        console.log('Showing Chrome install prompt...');
                        const promptResult = await deferredPrompt.prompt();
                        console.log('Prompt shown, result:', promptResult);
                        
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`PWA install prompt outcome: ${outcome}`);
                        
                        if (outcome === 'accepted') {
                            banner.style.transform = 'translateY(-100%)';
                            setTimeout(() => banner.remove(), 300);
                            console.log('Install accepted - banner removed');
                        } else {
                            console.log('Install declined by user');
                        }
                        deferredPrompt = null;
                    } catch (error) {
                        console.error('Error showing install prompt:', error);
                        // Fallback to instructions
                        showInstallInstructions();
                    }
                } else {
                    // Show detailed instructions modal
                    console.log('No deferred prompt, showing instructions');
                    showInstallInstructions();
                }
            };
            
            // Debug button for Android Chrome users
            const debugBtn = document.getElementById('debug-install');
            if (debugBtn) {
                debugBtn.onclick = () => {
                    showInstallDiagnostic();
                };
            }
            
            installPromptShown = true;
        }
        
        // Show detailed install instructions modal
        function showInstallInstructions() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                backdrop-filter: blur(5px);
                z-index: 10002;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            const isIOS = /iPad|iPhone|iPod/.test(navigator.userAgent) && !window.MSStream;
            const isAndroid = /Android/.test(navigator.userAgent);
            
            let instructions = '';
            if (isIOS) {
                instructions = `
                    <h3 style="margin-bottom: 20px; color: #2c5530;">üì± Install on iPad/iPhone</h3>
                    <ol style="text-align: left; line-height: 1.8;">
                        <li>Look for the <strong>Share button</strong> ‚ÜóÔ∏è in Safari (usually at the top or bottom)</li>
                        <li>Scroll down and tap <strong>"Add to Home Screen"</strong></li>
                        <li>Customize the name if desired</li>
                        <li>Tap <strong>"Add"</strong> to install</li>
                    </ol>
                    <p style="margin-top: 15px; font-size: 14px; opacity: 0.8;">
                        The app will appear on your home screen like a native app!
                    </p>
                `;
            } else if (isAndroid) {
                const isChrome = /Chrome/.test(navigator.userAgent);
                const isSamsung = /SamsungBrowser/.test(navigator.userAgent);
                
                let browserSpecific = '';
                if (isChrome) {
                    browserSpecific = `
                        <div style="background: #e3f2fd; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #1976d2;">üì± Chrome Browser:</h4>
                            <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                                <li><strong>Look at the address bar</strong> - Chrome may show a small "Install" or "+" icon</li>
                                <li><strong>Tap the 3-dot menu</strong> (‚ãÆ) in the top-right corner</li>
                                <li>Scroll down and look for <strong>"Add to Home screen"</strong> or <strong>"Install app"</strong></li>
                                <li>Tap it and follow the prompts</li>
                            </ol>
                        </div>
                    `;
                } else if (isSamsung) {
                    browserSpecific = `
                        <div style="background: #f3e5f5; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #7b1fa2;">üì± Samsung Internet:</h4>
                            <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                                <li>Tap the <strong>menu button</strong> (‚ò∞) at the bottom</li>
                                <li>Look for <strong>"Add page to"</strong> ‚Üí <strong>"Home screen"</strong></li>
                                <li>Customize the name and tap <strong>"Add"</strong></li>
                            </ol>
                        </div>
                    `;
                } else {
                    browserSpecific = `
                        <div style="background: #fff3e0; padding: 15px; border-radius: 8px; margin: 15px 0;">
                            <h4 style="margin: 0 0 10px 0; color: #f57c00;">üì± Other Android Browser:</h4>
                            <ol style="margin: 0; padding-left: 20px; line-height: 1.6;">
                                <li>Look for the <strong>menu button</strong> (usually ‚ãÆ, ‚ò∞, or ‚ãØ)</li>
                                <li>Find <strong>"Add to Home screen"</strong>, <strong>"Install"</strong>, or <strong>"Bookmark"</strong></li>
                                <li>Choose the option to add to home screen</li>
                            </ol>
                        </div>
                    `;
                }
                
                instructions = `
                    <h3 style="margin-bottom: 20px; color: #2c5530;">üì± Install QuickBasket on Android</h3>
                    
                    ${browserSpecific}
                    
                    <div style="background: #f1f8e9; padding: 15px; border-radius: 8px; margin: 15px 0;">
                        <h4 style="margin: 0 0 10px 0; color: #558b2f;">üí° Alternative Methods:</h4>
                        <ul style="margin: 0; padding-left: 20px; line-height: 1.6;">
                            <li><strong>Address Bar:</strong> Some browsers show an install icon in the address bar</li>
                            <li><strong>Bottom Banner:</strong> Look for install prompts at the bottom of the page</li>
                            <li><strong>Settings:</strong> Some browsers have install options in Settings ‚Üí Advanced</li>
                        </ul>
                    </div>
                    
                    <div style="background: #fff8e1; padding: 15px; border-radius: 8px; margin: 15px 0; border-left: 4px solid #ffc107;">
                        <p style="margin: 0; font-size: 14px;">
                            <strong>üìã Note:</strong> If none of these options appear, your browser may not support PWA installation. 
                            Try using <strong>Chrome</strong> or <strong>Samsung Internet</strong> for the best experience.
                        </p>
                    </div>
                `;
            } else {
                instructions = `
                    <h3 style="margin-bottom: 20px; color: #2c5530;">üì± Install QuickBasket</h3>
                    <ul style="text-align: left; line-height: 1.8;">
                        <li><strong>Chrome/Edge:</strong> Look for install button in address bar or menu</li>
                        <li><strong>Firefox:</strong> Use "Add to Home Screen" in menu</li>
                        <li><strong>Safari:</strong> Use Share ‚Üí "Add to Home Screen"</li>
                    </ul>
                    <p style="margin-top: 15px; font-size: 14px; opacity: 0.8;">
                        Installing makes QuickBasket work like a native app!
                    </p>
                `;
            }
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    padding: 30px;
                    max-width: 500px;
                    width: 100%;
                    text-align: center;
                    box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
                ">
                    ${instructions}
                    <button onclick="this.closest('div').parentElement.remove()" style="
                        background: #2c5530;
                        color: white;
                        border: none;
                        padding: 12px 24px;
                        border-radius: 8px;
                        font-weight: 600;
                        cursor: pointer;
                        margin-top: 20px;
                        transition: all 0.2s ease;
                    ">Got it!</button>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }
        
        // Show install diagnostic for Android Chrome
        function showInstallDiagnostic() {
            const modal = document.createElement('div');
            modal.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.8);
                backdrop-filter: blur(5px);
                z-index: 10002;
                display: flex;
                align-items: center;
                justify-content: center;
                padding: 20px;
            `;
            
            const isHttps = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname.includes('192.168');
            const hasServiceWorker = 'serviceWorker' in navigator;
            const hasManifest = !!document.querySelector('link[rel="manifest"]');
            const isStandalone = window.matchMedia('(display-mode: standalone)').matches;
            const isChrome = /Chrome/.test(navigator.userAgent);
            const chromeVersion = navigator.userAgent.match(/Chrome\/(\d+)/)?.[1] || 'Unknown';
            
            const requirements = [
                { name: 'HTTPS Connection', status: isHttps, detail: `Protocol: ${location.protocol}` },
                { name: 'Chrome Browser', status: isChrome, detail: `Version: ${chromeVersion}` },
                { name: 'Service Worker', status: hasServiceWorker, detail: 'Required for offline functionality' },
                { name: 'Web App Manifest', status: hasManifest, detail: 'Defines app properties' },
                { name: 'Not Already Installed', status: !isStandalone, detail: isStandalone ? 'Already in PWA mode' : 'Ready to install' },
                { name: 'Install Prompt Available', status: !!deferredPrompt, detail: deferredPrompt ? 'Chrome detected installable app' : 'No automatic prompt detected' }
            ];
            
            const requirementsList = requirements.map(req => `
                <div style="display: flex; align-items: center; margin: 10px 0; padding: 10px; background: ${req.status ? '#e8f5e8' : '#ffe8e8'}; border-radius: 6px;">
                    <span style="font-size: 18px; margin-right: 10px;">${req.status ? '‚úÖ' : '‚ùå'}</span>
                    <div style="flex: 1; text-align: left;">
                        <div style="font-weight: 600;">${req.name}</div>
                        <div style="font-size: 12px; color: #666;">${req.detail}</div>
                    </div>
                </div>
            `).join('');
            
            const allMet = requirements.every(req => req.status);
            
            modal.innerHTML = `
                <div style="
                    background: white;
                    border-radius: 16px;
                    padding: 30px;
                    max-width: 600px;
                    width: 100%;
                    text-align: center;
                    box-shadow: 0 20px 25px -5px rgba(0,0,0,0.1);
                    max-height: 80vh;
                    overflow-y: auto;
                ">
                    <h3 style="margin-bottom: 20px; color: #2c5530;">üîß PWA Install Diagnostic</h3>
                    
                    <div style="text-align: left; margin: 20px 0;">
                        ${requirementsList}
                    </div>
                    
                    <div style="background: ${allMet ? '#e8f5e8' : '#fff3cd'}; padding: 15px; border-radius: 8px; margin: 20px 0;">
                        <h4 style="margin: 0 0 10px 0; color: ${allMet ? '#2c5530' : '#856404'};">
                            ${allMet ? 'üéâ All Requirements Met!' : '‚ö†Ô∏è Some Requirements Missing'}
                        </h4>
                        <p style="margin: 0; font-size: 14px;">
                            ${allMet 
                                ? 'Your browser should show an install prompt. If not, try refreshing the page or check Chrome settings.' 
                                : 'Fix the issues above to enable PWA installation. You can still add to home screen manually.'}
                        </p>
                    </div>
                    
                    <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap;">
                        <button onclick="this.closest('div').parentElement.remove()" style="
                            background: #2c5530;
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s ease;
                        ">Close</button>
                        <button onclick="window.open('/pwa-debug/', '_blank')" style="
                            background: #6c757d;
                            color: white;
                            border: none;
                            padding: 12px 24px;
                            border-radius: 8px;
                            font-weight: 600;
                            cursor: pointer;
                            transition: all 0.2s ease;
                        ">Full Debug Tool</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
            modal.onclick = (e) => {
                if (e.target === modal) modal.remove();
            };
        }
        
        // Chrome/Edge beforeinstallprompt handler with enhanced Android detection
        window.addEventListener('beforeinstallprompt', (e) => {
            console.log('‚úÖ beforeinstallprompt event fired - Native Chrome install available');
            e.preventDefault();
            deferredPrompt = e;
            
            const isAndroid = /Android/.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent);
            
            console.log('Install prompt details:', {
                isAndroid: isAndroid,
                isChrome: isChrome,
                userAgent: navigator.userAgent.substring(0, 100) + '...'
            });
            
            // Show install banner immediately when prompt is available
            createInstallBanner();
            
            // Also create a floating install button for backup
            createFloatingInstallButton();
        });
        
        // Enhanced PWA installability check for Android
        function checkAndroidPWARequirements() {
            const isAndroid = /Android/.test(navigator.userAgent);
            const isChrome = /Chrome/.test(navigator.userAgent);
            const isHttps = location.protocol === 'https:' || location.hostname === 'localhost' || location.hostname.includes('192.168');
            
            if (!isAndroid || !isChrome) return false;
            
            console.log('Android Chrome PWA Requirements Check:', {
                https: isHttps,
                serviceWorker: 'serviceWorker' in navigator,
                manifest: !!document.querySelector('link[rel="manifest"]'),
                standalone: !window.matchMedia('(display-mode: standalone)').matches,
                userEngagement: document.hasFocus(),
                beforeInstallPrompt: !!deferredPrompt
            });
            
            return true;
        }
        
        // Create floating install button for Chrome
        function createFloatingInstallButton() {
            if (document.getElementById('floating-install-btn') || !deferredPrompt) return;
            
            const floatingBtn = document.createElement('button');
            floatingBtn.id = 'floating-install-btn';
            floatingBtn.innerHTML = 'üì± Install';
            floatingBtn.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: #2c5530;
                color: white;
                border: none;
                border-radius: 25px;
                padding: 12px 20px;
                font-size: 14px;
                font-weight: 600;
                cursor: pointer;
                box-shadow: 0 4px 12px rgba(44,85,48,0.3);
                z-index: 10000;
                transition: all 0.3s ease;
                backdrop-filter: blur(10px);
            `;
            
            floatingBtn.onmouseover = () => {
                floatingBtn.style.transform = 'translateY(-2px)';
                floatingBtn.style.boxShadow = '0 6px 20px rgba(44,85,48,0.4)';
            };
            
            floatingBtn.onmouseout = () => {
                floatingBtn.style.transform = 'translateY(0)';
                floatingBtn.style.boxShadow = '0 4px 12px rgba(44,85,48,0.3)';
            };
            
            floatingBtn.onclick = async () => {
                console.log('Floating install button clicked');
                if (deferredPrompt) {
                    try {
                        console.log('Triggering Chrome install prompt from floating button...');
                        await deferredPrompt.prompt();
                        const { outcome } = await deferredPrompt.userChoice;
                        console.log(`Install outcome from floating button: ${outcome}`);
                        
                        if (outcome === 'accepted') {
                            floatingBtn.remove();
                            const banner = document.getElementById('install-banner');
                            if (banner) {
                                banner.style.transform = 'translateY(-100%)';
                                setTimeout(() => banner.remove(), 300);
                            }
                        }
                        deferredPrompt = null;
                    } catch (error) {
                        console.error('Error with floating button install:', error);
                        showInstallInstructions();
                    }
                }
            };
            
            document.body.appendChild(floatingBtn);
            console.log('Floating install button created');
        }
        
        // Check for install criteria on page load
        window.addEventListener('load', () => {
            const dismissed = localStorage.getItem('pwa-install-dismissed');
            const daysSinceDismissed = dismissed ? (Date.now() - parseInt(dismissed)) / (1000 * 60 * 60 * 24) : 999;
            
            console.log('Page loaded - checking install criteria:', {
                dismissed: !!dismissed,
                daysSinceDismissed: daysSinceDismissed,
                isStandalone: window.matchMedia('(display-mode: standalone)').matches
            });
            
            // Show banner if not dismissed recently or if it's been more than 7 days
            if (!dismissed || daysSinceDismissed > 7) {
                // Wait a bit for page to load, then show install prompt
                setTimeout(() => {
                    console.log('Checking if should show install prompt:', {
                        deferredPrompt: !!deferredPrompt,
                        installPromptShown: installPromptShown
                    });
                    
                    if (!deferredPrompt && !installPromptShown) {
                        console.log('No deferred prompt yet, showing banner anyway for non-Chrome browsers');
                        createInstallBanner();
                    }
                }, 3000);
            }
            
            // Force check for Chrome users who might not get beforeinstallprompt
            setTimeout(() => {
                const isChrome = /Chrome/.test(navigator.userAgent) && /Google Inc/.test(navigator.vendor);
                if (isChrome && !deferredPrompt && !installPromptShown) {
                    console.log('Chrome detected but no beforeinstallprompt - showing fallback');
                    createInstallBanner();
                }
            }, 5000);
        });

        window.addEventListener('appinstalled', (evt) => {
            console.log('QuickBasket PWA installed successfully');
            const banner = document.getElementById('install-banner');
            if (banner) {
                banner.style.transform = 'translateY(-100%)';
                setTimeout(() => banner.remove(), 300);
            }
        });

        // Handle offline/online status for PWA
        function updateOnlineStatus() {
            const statusIndicator = document.getElementById('connection-status') || document.createElement('div');
            if (!document.getElementById('connection-status')) {
                statusIndicator.id = 'connection-status';
                statusIndicator.style.cssText = `
                    position: fixed;
                    top: 10px;
                    left: 50%;
                    transform: translateX(-50%);
                    padding: 8px 16px;
                    border-radius: 20px;
                    font-size: 12px;
                    font-weight: 600;
                    z-index: 1001;
                    transition: all 0.3s ease;
                `;
                document.body.appendChild(statusIndicator);
            }
            
            if (navigator.onLine) {
                statusIndicator.style.background = 'var(--success-color)';
                statusIndicator.style.color = 'white';
                statusIndicator.textContent = 'üåê Online - Full functionality available';
                setTimeout(() => statusIndicator.style.display = 'none', 3000);
            } else {
                statusIndicator.style.background = 'var(--warning-color)';
                statusIndicator.style.color = 'white';
                statusIndicator.style.display = 'block';
                statusIndicator.textContent = 'üì± Offline - Limited functionality';
            }
        }

        window.addEventListener('online', updateOnlineStatus);
        window.addEventListener('offline', updateOnlineStatus);
    </script>
</body>
</html>